<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>ETFæŒè‚¡åˆ†æå¹³å°</title>
    <style>
body{font-family:'Segoe UI',Tahoma;background:#f7f7fa;color:#333;margin:0;}
.header{background:linear-gradient(120deg,#7964e7 0%,#53a0e2 100%);color:white;padding:36px 0 13px 0;text-align:center;margin-bottom:32px;}
.header h1{margin:0;font-size:2.2rem;font-weight:600;}
.header p{margin:13px 0 0 0;font-size:1.07rem;font-weight:400;}
.update{color:#e3e5ea;font-size:1.08rem;margin-top:7px;}
.container{max-width:980px;margin:0 auto;padding:0 20px;}
.panel{background:#fff;border-radius:18px;box-shadow:0 2px 10px rgba(80,90,140,.09);padding:30px 32px 20px 32px;margin-bottom:34px;}
.panel-title{font-size:1.45rem;font-weight:520;display:flex;align-items:center;margin-bottom:20px;}
.panel-title .icon{font-size:1.7em;margin-right:8px;}
.etf-tabs{display:flex;gap:40px;border-bottom:2px solid #edeefa;margin-bottom:18px;padding-bottom:7px;}
.etf-tab{font-size:1.18rem;color:#6d7dc7;cursor:pointer;border:none;background:none;border-bottom:2.5px solid transparent;transition:all .23s;padding:0;}
.etf-tab.active{color:#7964e7;border-bottom:2.5px solid #7964e7;}
.etf-tab:hover{color:#7964e7;}
.search-box{background:#f9fbfe;padding:16px 20px;border-radius:8px;margin-bottom:20px;}
#searchInput{width:99%;padding:11px;font-size:15px;border:1px solid #ddd;border-radius:6px;}
.changes-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px;margin-top:16px;}
.change-card{background:#f9fbfe;border-left:4px solid #7964e7;padding:18px 20px;border-radius:8px;cursor:pointer;transition:all .2s;}
.change-card:hover{background:#f0f4fe;transform:translateY(-2px);box-shadow:0 4px 12px rgba(121,100,231,.12);}
.change-code{font-size:20px;font-weight:bold;color:#546ded;}
.change-name{font-size:14px;color:#666;margin-top:2px;margin-bottom:8px;}
.change-stats{display:flex;gap:16px;margin-top:10px;font-size:13px;}
.change-stat-label{color:#999;}
.change-stat-value{font-weight:bold;color:#222;}
.status-badge{display:inline-block;padding:3px 8px;border-radius:12px;font-size:12px;font-weight:600;}
.status-new{background:#d4edda;color:#155724;}
.status-add{background:#d1ecf1;color:#0c5460;}
.status-reduce{background:#f8d7da;color:#721c24;}
.status-delete{background:#f8d7da;color:#721c24;}
.positive{color:#27ae60;}
.negative{color:#e74c3c;}
.detail-page{display:none;}
.detail-page.active{display:block;}
.back-btn{background:#546ded;color:white;border:none;padding:12px 21px;border-radius:5px;cursor:pointer;margin-bottom:24px;font-size:15px;}
.back-btn:hover{background:#714ba2;}
.stock-header{background:white;padding:22px;border-radius:9px;margin-bottom:21px;box-shadow:0 2px 10px rgba(140,140,240,.08);}
.stock-title{font-size:25px;font-weight:bold;color:#222;margin-bottom:15px;}
.stats{display:flex;gap:30px;margin-bottom:8px;}
.stat-box{background:#f0f4fe;padding:15px 22px;border-radius:7px;text-align:center;flex:1;}
.stat-value{font-size:23px;font-weight:bold;color:#546ded;}
.stat-label{font-size:13px;color:#888;margin-top:2px;}
.history-table{background:white;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.07);}
table{width:100%;border-collapse:collapse;}
th{background-color:#f5f7fa;padding:12px;text-align:left;font-weight:600;font-size:14px;color:#333;border-bottom:2px solid #eee;}
td{padding:12px;border-bottom:1px solid #eee;font-size:14px;}
tr:hover{background-color:#f6f9fd;}
@media(max-width:760px){.etf-tabs{flex-wrap:wrap;gap:10px;}.changes-grid{grid-template-columns:1fr;}}
    </style>
</head>
<body>
<div class="header">
    <h1>ğŸ›ï¸ ETFæŒè‚¡åˆ†æå¹³å° <span style="font-size:13px;font-weight:500;color:#dedafc;background:#7b70c6;border-radius:7px;padding:1.5px 9px;margin-left:8px;">v2.0</span></h1>
    <p class="update" id="updateTime"></p>
    <p style="font-weight:400;margin-top:8px;">è³‡æ–™ä¾†æº: ç¾¤ç›Šã€é‡æ‘</p>
</div>
<div id="mainPage">
    <div class="container">
        <div class="panel">
            <div class="panel-title"><span class="icon">ğŸ“Š</span> ETF ä»Šæ—¥è®Šå‹•</div>
            <div class="etf-tabs" id="etfTabs"></div>
            <div class="search-box" id="searchBoxContainer"></div>
            <div class="changes-grid" id="changesGrid"></div>
        </div>
    </div>
</div>
<div id="detailPage" class="detail-page">
    <div class="container">
        <button class="back-btn" onclick="backToMain()">â† è¿”å›ç•°å‹•åˆ—è¡¨</button>
        <div class="stock-header">
            <div class="stock-title" id="detailTitle"></div>
            <div class="stats" id="statsContainer"></div>
        </div>
        <div class="history-table">
            <table id="historyTable">
                <thead>
                    <tr>
                        <th>æ—¥æœŸ</th>
                        <th>æŒè‚¡(å¼µ)</th>
                        <th>æ¬Šé‡(%)</th>
                        <th>å¼µæ•¸è®Šå‹•</th>
                        <th>æ¬Šé‡è®Šå‹•</th>
                        <th>ç‹€æ…‹</th>
                    </tr>
                </thead>
                <tbody id="historyBody"></tbody>
            </table>
        </div>
    </div>
</div>
<script>
let processedData = {};
let stockData = {};
let currentETF = null;
let currentStock = null;

function renderMainPage() {
    const tabsContainer = document.getElementById('etfTabs');
    tabsContainer.innerHTML = '';
    if (Object.keys(processedData).length === 0) {
        document.getElementById('mainPage').innerHTML = '<p style="text-align:center;color:#999;padding:40px;">è³‡æ–™è¼‰å…¥ä¸­...</p>';
        return;
    }
    Object.keys(processedData).forEach(code => {
        const tab = document.createElement('button');
        tab.className = 'etf-tab' + (currentETF === code ? ' active' : '');
        tab.textContent = `${code} ${processedData[code].name.split(' ')[0]}`;
        tab.onclick = () => switchETF(code);
        tabsContainer.appendChild(tab);
    });
    if (!currentETF) currentETF = Object.keys(processedData)[0];
    renderChanges();
}

function renderChanges() {
    const data = processedData[currentETF];
    if (!data) return;
    
    const grid = document.getElementById('changesGrid');
    grid.innerHTML = '';
    
    if (!data.daily_changes || data.daily_changes.length === 0) {
        grid.innerHTML = '<p style="color:#999;">ä»Šæ—¥ç„¡ç•°å‹•è³‡æ–™</p>';
        return;
    }
    
    data.daily_changes.forEach(change => {
        const statusClass = change.type === 'æ–°å¢' ? 'status-new' : 
                           change.type === 'å¢æŒ' ? 'status-add' : 'status-reduce';
        const card = document.createElement('div');
        card.className = 'change-card';
        card.onclick = () => {
            if (stockData[change.code]) showStockDetail(change.code);
        };
        card.innerHTML = `
            <div style="display:flex;justify-content:space-between;align-items:start;">
                <div>
                    <div class="change-code">${change.code}</div>
                    <div class="change-name">${change.name}</div>
                </div>
                <span class="status-badge ${statusClass}">${change.type}</span>
            </div>
            <div class="change-stats">
                <div>
                    <div class="change-stat-label">ä»Šæ—¥æŒè‚¡</div>
                    <div class="change-stat-value">${change.current_count.toLocaleString()}</div>
                </div>
                <div>
                    <div class="change-stat-label">ä»Šæ—¥æ¬Šé‡</div>
                    <div class="change-stat-value">${change.current_weight.toFixed(2)}%</div>
                </div>
                <div>
                    <div class="change-stat-label">å¼µæ•¸è®Šå‹•</div>
                    <div class="change-stat-value ${change.count_change > 0 ? 'positive' : 'negative'}">
                        ${change.count_change > 0 ? '+' : ''}${change.count_change.toLocaleString()}
                    </div>
                </div>
                <div>
                    <div class="change-stat-label">æ¬Šé‡è®Šå‹•</div>
                    <div class="change-stat-value ${change.weight_change > 0 ? 'positive' : 'negative'}">
                        ${change.weight_change > 0 ? '+' : ''}${change.weight_change.toFixed(2)}%
                    </div>
                </div>
            </div>
        `;
        grid.appendChild(card);
    });
}

function switchETF(code) {
    currentETF = code;
    document.querySelectorAll('.etf-tab').forEach(tab => tab.classList.remove('active'));
    event.target.classList.add('active');
    renderChanges();
}

function showStockDetail(stockCode) {
    if (!stockData[stockCode]) return;
    currentStock = stockCode;
    const stock = stockData[stockCode];
    document.getElementById('mainPage').style.display = 'none';
    document.getElementById('detailPage').classList.add('active');
    document.getElementById('detailTitle').textContent = `${stock.code} ${stock.name}`;
    const etfCount = Object.keys(stock.etf_holdings).length;
    const totalCount = Object.values(stock.etf_holdings).reduce((s,e) => s + (e.current_count||0), 0);
    document.getElementById('statsContainer').innerHTML = `
        <div class="stat-box"><div class="stat-value">${etfCount}</div><div class="stat-label">æŒæœ‰ETFæ•¸é‡</div></div>
        <div class="stat-box"><div class="stat-value">${totalCount.toLocaleString()}</div><div class="stat-label">ç•¶å‰ç¸½æŒè‚¡</div></div>
    `;
    const history = stock.etf_holdings[currentETF]?.history || [];
    let html = '';
    history.forEach(r => {
        const changeClass = r.count_change > 0 ? 'positive' : r.count_change < 0 ? 'negative' : '';
        html += `<tr>
            <td>${r.date}</td>
            <td>${r.count.toLocaleString()}</td>
            <td>${r.weight.toFixed(2)}%</td>
            <td class="${changeClass}">${r.count_change >= 0 ? '+' : ''}${r.count_change.toLocaleString()}</td>
            <td class="${changeClass}">${r.weight_change >= 0 ? '+' : ''}${r.weight_change.toFixed(2)}%</td>
            <td>${r.status}</td>
        </tr>`;
    });
    document.getElementById('historyBody').innerHTML = html;
}

function backToMain() {
    document.getElementById('mainPage').style.display = 'block';
    document.getElementById('detailPage').classList.remove('active');
    currentStock = null;
}

document.addEventListener('DOMContentLoaded', () => {
    Promise.all([
        fetch('./processed_etf_data.json').then(r => r.json()),
        fetch('./stock_history_data.json').then(r => r.json())
    ]).then(([pdata, sdata]) => {
        processedData = pdata;
        stockData = sdata;
        let latest = "";
        let first = processedData[Object.keys(processedData)[0]];
        if(first && first.latest_date){
            latest = "æœ€æ–°æ›´æ–°: " + first.latest_date;
            document.getElementById('updateTime').textContent = latest;
        }
        renderMainPage();
    }).catch(e => {
        console.error('è¼‰å…¥éŒ¯èª¤:', e);
        document.getElementById('mainPage').innerHTML = '<p style="color:red;text-align:center;padding:40px;">æª”æ¡ˆè¼‰å…¥å¤±æ•—</p>';
    });
});
</script>
</body>
</html>
